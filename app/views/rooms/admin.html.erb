<script type="application/javascript">
    var channel = dispatcher.subscribe('room:' + <%= @room.id %>);
    channel.bind('updated', function(data) {
        var getRoom = $.get('<%= room_path(@room, format: :json) %>');
        var getAttendees = $.get('<%= room_attendees_path(@room, format: :json) %>');
        $.when(getRoom, getAttendees).done(function(room, attendees) {
            var html = HandlebarsTemplates['attendee_scores']({
                room: room[0],
                attendees: attendees[0]
            });
            $('#scores').html(html);
        });
    });

    $(function() {
        var client = new ZeroClipboard( document.getElementById("copy-join-link") );
    });
</script>

<div class="row">
  <div class="large-12 columns">
    <h3>Room #<%= @room.id %></h3>
  </div>

  <div class="large-6 columns">
    <% if @room.attendees.empty? %>

      <div class="panel">
        Waiting for attendees
      </div>

    <% else %>

    <div id="scores">
    <table class="scores">
      <% @room.attendees.each do |attendee| %>
        <tr>
          <td style="width: 20%;">
            <a href="#" data-dropdown="dd-attendee-<%= attendee.id %>" data-options="is_hover:true;">
              <i class="fi-widget"></i>
            </a>
            <ul id="dd-attendee-<%= attendee.id %>" class="f-dropdown" data-dropdown-content>
              <li>
                <%= link_to 'Remove', attendee_path(attendee, format: :json), remote: true, method: :delete %>
              </li>
            </ul>
          </td>
          <td style="width: 50%;">
            <%= attendee.name %>
          </td>
          <td style="width: 30%;">
            <% if @room.show_scores %>
              <%= attendee.score %>
            <% elsif !attendee.score.nil? %>
              <span class="success label">ready</span>
            <% end %>
          </td>
        </tr>
      <% end %>
    </table>
    </div>

    <ul class="button-group">
      <li><%= button_to "Show", show_scores_room_path(@room), class: 'button' %></li>
      <li><%= button_to "Reset", reset_room_path(@room), class: 'alert button' %></li>
    </ul>

    <% end %>
  </div>

  <div class="large-6 columns">
    <div class="panel">
      <h4>Invite attendees</h4>
      <div class="row collapse">
        <div class="large-10 columns">
          <input type="text" value="<%= room_url(@room) %>" />
        </div>
        <div class="large-2 columns">
          <a id="copy-join-link" class="button postfix" data-clipboard-text="<%= room_url(@room) %>" href="#">Copy</a>
        </div>
      </div>
    </div>
  </div>
</div>
